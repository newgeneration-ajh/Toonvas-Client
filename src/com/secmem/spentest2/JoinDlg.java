package com.secmem.spentest2;

import java.io.UnsupportedEncodingException;
import java.nio.ByteBuffer;
import java.nio.ByteOrder;

import android.app.Dialog;
import android.content.Context;
import android.os.Bundle;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

import com.secmem.packet.PacketData;
import com.secmem.packet.PacketType;
import com.secmem.packet.SendManager;

public class JoinDlg extends Dialog implements OnClickListener {

	private EditText joinID, joinPW;
	private Button joinOK, joinCancel;
	private String strID, strPW;

	private PacketData m_SendData = null;
	
	public JoinDlg(Context context) {
		super(context);
	}
	
	

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		
		setContentView(R.layout.dialog_join);
		
		joinID = (EditText) findViewById(R.id.joinID);
		joinPW = (EditText) findViewById(R.id.joinPW);
		joinOK = (Button) findViewById(R.id.joinOK);
		joinCancel = (Button) findViewById(R.id.joinCancel);
		
		joinOK.setOnClickListener(this);
		joinCancel.setOnClickListener(this);
		
	}
	
	public String getJoinID(){
		return strID;
	}
	
	public String getJoinPW(){
		return strPW;
	}
	
	@Override
	public void onClick(View v) {
		if(v == joinOK){
			strID = joinID.getText().toString();
			strPW = joinPW.getText().toString();
	
			ByteBuffer sBuffer = ByteBuffer.allocate(4088);
			sBuffer.order(ByteOrder.LITTLE_ENDIAN);
			
			byte[] arrZero = new byte[16];
			for (int i = 0; i < 16; i++) {
				arrZero[i] = 0;
			}
			
			try {
				sBuffer.put(strID.getBytes("KSC5601"));
				sBuffer.put(arrZero, 0, 16 - strID.getBytes().length);
				sBuffer.put(strPW.getBytes("KSC5601"));
				sBuffer.put(arrZero, 0, 16 - strPW.getBytes().length);
			} catch (UnsupportedEncodingException e) {
				e.printStackTrace();
			}

			sBuffer.flip(); // 버퍼포인터를 처음으로 돌린다

			// 패킷 전송 ... SendPacket()에서 헤더를 붙여야 하기때문에 다시 바이트로 변환
			byte[] sBuf = sBuffer.array();
			
			m_SendData = new PacketData ( PacketType.REQ_JOIN , sBuf , 32 );
			
			SendManager.pushQueue(m_SendData);
			
			m_SendData = null;
			dismiss();
		}
		else if( v == joinCancel ){
			Toast.makeText(getContext(), "Join Cancel", Toast.LENGTH_SHORT).show();
			cancel();
		}
		
	}

}
